@model WebApp.ViewModels.ProjectCardViewModel
@using WebApp.Helpers

@{
    bool isNotStarted = ProjectHelper.IsNotStarted(Model.StartDate);
    bool isCompleted = ProjectHelper.IsCompleted(Model.EndDate);
    bool isEndingSoon = ProjectHelper.IsEndingSoon(Model.EndDate, 5);

    string badgeClass = isNotStarted ? "not-started"
                       : isCompleted ? "ended"
                       : isEndingSoon ? "soon"
                       : "normal";

    string? badgeText = null;

    if (isNotStarted)
    {
        badgeText = "Not started";
    }
    else if (isCompleted)
    {
        badgeText = "Ended";
    }
    else if (Model.EndDate.HasValue)
    {
        badgeText = ProjectHelper.GetTimeLeft(Model.EndDate.Value);
    }

    bool showBadge = badgeText != null;
}

<div class="project-card" data-member-id="@Model.Id">
    <button class="edit-btn edit-project-btn"
            data-fetch-url='@Url.Action("EditProject", "ProjectCrud", new { id = Model.Id })'
            data-container="editProjectContainer">
        <img src="~/Images/Icons/More 2.svg" alt="Edit" class="project-card-edit" />
    </button>

    <div class="project-card-header">
        <img src="~/@Model.ImageName" alt="Avatar" class="project-card-avatar" />
        <div class="project-card-header-text">
            <h4>@Model.ProjectName</h4>
            @if (!string.IsNullOrWhiteSpace(Model.ClientName))
            {
                <div class="project-card-client">@Model.ClientName</div>
            }
        </div>
    </div>

    @if (!string.IsNullOrWhiteSpace(Model.Description))
    {
        <div class="project-card-description">@Model.Description</div>
    }

    @if (showBadge)
    {
        <div class="project-card-deadline-and-members">
            <span class="project-card-deadline @badgeClass">
                <img src="~/Images/Icons/Time.svg" alt="Clock" class="clock-icon" />
                @badgeText
            </span>

            <div class="project-card-members">
                @foreach (var memberImg in Model.MemberImageNames)
                {
                    <img src="~/@memberImg" alt="Member" class="project-card-memberimg" />
                }
            </div>
        </div>
    }
</div>
