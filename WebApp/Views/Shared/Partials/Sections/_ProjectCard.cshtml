@model WebApp.ViewModels.ProjectCardViewModel
@using WebApp.Helpers

@{
    bool isNotStarted = ProjectHelper.IsNotStarted(Model.StartDate);
    bool isCompleted = ProjectHelper.IsCompleted(Model.EndDate);
    bool isEndingSoon = ProjectHelper.IsEndingSoon(Model.EndDate, 5);

    string badgeClass = isNotStarted ? "not-started"
                       : isCompleted ? "ended"
                       : isEndingSoon ? "soon"
                       : "normal";

    string? badgeText = null;
    string? iconPath = "Images/Icons/Time.svg";

    if (isNotStarted)
    {
        badgeText = "Not started";
        iconPath = "Images/Icons/Time.svg";
    }
    else if (isCompleted)
    {
        badgeText = "Ended";
        iconPath = "Images/Icons/Timered.svg";
    }
    else if (isEndingSoon)
    {
        badgeText = ProjectHelper.GetTimeLeft(Model.EndDate!.Value);
        iconPath = "Images/Icons/Timered.svg";
    }
    else if (Model.EndDate.HasValue)
    {
        badgeText = ProjectHelper.GetTimeLeft(Model.EndDate.Value);
        iconPath = "Images/Icons/Time.svg";
    }

    bool showBadge = badgeText != null;
}

<div class="project-card" data-member-id="@Model.Id">

    <div class="settings-menu-wrapper">
        <button class="edit-btn dropdown-toggle"
                data-dropdown="projectEditDropdown-@Model.Id">
            <img src="~/Images/Icons/More 2.svg"
                 alt="Actions"
                 class="project-card-edit" />
        </button>

        <div class="settings-dropdown project-dropdown hidden dropdown-menu"
             id="projectEditDropdown-@Model.Id">

            <!-- Edit -->
            <button type="button"
                    class="edit-menu-item"
                    data-fetch-url='@Url.Action("EditProject", "ProjectCrud", new { id = Model.Id })'
                    data-container="editProjectContainer">
                <img src="~/images/icons/Edit.svg"
                     class="icon-small"
                     alt="Edit" />
                <span>Edit</span>
            </button>

            <!-- Add Member -->
            <button type="button"
                    class="edit-menu-item"
                    data-action="add-member"
                    data-id="@Model.Id">
                <img src="~/images/icons/UserAdd.svg"
                     class="icon-small"
                     alt="Add Member" />
                <span>Add Member</span>
            </button>

            <!-- Separator -->
            <hr class="dropdown-separator" />

            <!-- Delete Project -->
            <button type="button"
                    class="edit-menu-item trash-menu-item"
                    data-action="delete-project"
                    data-id="@Model.Id">
                <img src="~/images/icons/TrashRed.svg"
                     class="icon-small"
                     alt="Delete Project" />
                <span>Delete Project</span>
            </button>
        </div>
    </div>

    <div class="project-card-header">
        <img src="~/@Model.ImageName" alt="Avatar" class="project-card-avatar" />
        <div class="project-card-header-text">
            <h4>@Model.ProjectName</h4>
            @if (!string.IsNullOrWhiteSpace(Model.ClientName))
            {
                <div class="project-card-client">@Model.ClientName</div>
            }
        </div>
    </div>

    @if (!string.IsNullOrWhiteSpace(Model.Description))
    {
        <div class="project-card-description">@Model.Description</div>
    }

    @if (showBadge)
    {
        <div class="project-card-deadline-and-members">
            <span class="project-card-deadline @badgeClass">
                <img src="~/@iconPath" alt="Clock" class="clock-icon" />
                @badgeText
            </span>

            <div class="project-card-members">
                @foreach (var memberImg in Model.MemberImageNames)
                {
                    <img src="~/@memberImg" alt="Member" class="project-card-memberimg" />
                }
            </div>
        </div>
    }
</div>
